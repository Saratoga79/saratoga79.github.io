name: Descargar múltiples documentos (con variable)

on:
  schedule:
    - cron: '0 9-21 * * *'habituales

  # 2️⃣ Disparador manual (añádelo)
  workflow_dispatch:
    # (Opcional) puedes definir inputs que el usuario rellene al lanzar el workflow
    inputs:
      debug:
        description: 'Activar modo debug (true/false)'
        required: false
        default: 'false'

jobs:
  download:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Instalar jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Descargar según JSON (variable)
        env:
          DOWNLOADS_JSON: ${{ vars.DOWNLOADS_JSON }}   # <‑‑ aquí usamos la variable
        run: |
          echo "$DOWNLOADS_JSON" | jq -c '.[]' | while read -r item; do
            url=$(echo "$item" | jq -r '.url')
            dest=$(echo "$item" | jq -r '.dest')
            mkdir -p "downloads/$(dirname "$dest")"
            echo "Descargando $url → downloads/$dest"
            curl -L "$url" -o "downloads/$dest"
          done

      - name: Subir artefactos
        uses: actions/upload-artifact@v4
        with:
          name: documentos-multiples
          path: downloads/**