name: Descargar documento programado

# -------------------------------------------------
# 1ï¸âƒ£ ProgramaciÃ³n (cron)
# -------------------------------------------------
# La sintaxis es la misma que la de cron de Linux:
# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ minuto (0 - 59)
# â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ hora (0 - 23)
# â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ dÃ­a del mes (1 - 31)
# â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ mes (1 - 12)
# â”‚ â”‚ â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ dÃ­a de la semana (0 - 6) (Dom=0)
# â”‚ â”‚ â”‚ â”‚ â”‚
# â”‚ â”‚ â”‚ â”‚ â”‚
# * * * * *
#
# Ejemplo: "0 9,15 * * *" â†’ a las 09:00 y 15:00 todos los dÃ­as
#
on:
  schedule:
    - cron: '0 9-21 * * *'   # <-- Cambia aquÃ­ los horarios deseados

# -------------------------------------------------
# 2ï¸âƒ£ DefiniciÃ³n del job
# -------------------------------------------------
jobs:
  download:
    runs-on: ubuntu-latest          # MÃ¡quina virtual Linux

    steps:
      # 2.1ï¸âƒ£ Checkout opcional (si quieres guardar el archivo en el repo)
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      # 2.2ï¸âƒ£ Configurar variables (URL y nombre de archivo)
      - name: Definir variables
        env:
          FILE_URL: https://ipfs.io/ipns/k2k4r8oqlcjxsritt5mczkcn4mmvcmymbqw7113fz2flkrerfwfps004/data/listas/lista_iptv.m3u      # â† Pon aquÃ­ la URL completa
          OUTPUT_PATH: ./rep/21      # ej.: ./downloads/document.pdf
        run: echo "Variables definidas"

      # 2.3ï¸âƒ£ Descargar el archivo
      - name: Descargar archivo con curl
        env:
          FILE_URL: ${{ env.FILE_URL }}
          OUTPUT_PATH: ${{ env.OUTPUT_PATH }}
        run: |
          mkdir -p "$(dirname "$OUTPUT_PATH")"
          curl -L "$FILE_URL" -o "$OUTPUT_PATH"
          echo "Archivo descargado en $OUTPUT_PATH"

      # 2.4ï¸âƒ£ (Opcional) Subir el archivo como artefacto de la ejecuciÃ³n
      - name: Guardar como artefacto
        if: always()                     # Siempre, aunque falle la descarga
        uses: actions/upload-artifact@v4
        with:
          name: documento-descargado
          path: ${{ env.OUTPUT_PATH }}

      # 2.5ï¸âƒ£ (Opcional) Commit y push si deseas que quede en el repo
      - name: Commit y push del archivo
        if: success()                    # SÃ³lo si la descarga tuvo Ã©xito
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add "${{ env.OUTPUT_PATH }}"
          git commit -m "ğŸ“¥ Descarga automÃ¡tica del documento $(date +'%Y-%m-%d %H:%M')"
          git push